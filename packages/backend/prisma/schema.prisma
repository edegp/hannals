generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 荷台（トラック）
model Truck {
  id                String   @id @default(cuid())
  name              String
  // 3Dファイルパス
  objFilePath       String
  mtlFilePath       String?
  // 入り口方向 (front, back, left, right)
  entranceDirection String   @default("back")
  // バウンディングボックス（mm単位、自動検出）
  minX              Float?
  minY              Float?
  minZ              Float?
  maxX              Float?
  maxY              Float?
  maxZ              Float?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  placements        Placement[]
}

// 配置セッション
model Placement {
  id           String       @id @default(cuid())
  truck        Truck        @relation(fields: [truckId], references: [id], onDelete: Cascade)
  truckId      String
  // 外部APIからの配置結果
  resultData   Json?
  // ボクセル化されたトラックの3Dモデル（外部APIから取得）
  voxelObjData String?      @db.Text
  voxelMtlData String?      @db.Text
  createdAt    DateTime     @default(now())
  items        PlacedItem[]
}

// 配置済み荷物
model PlacedItem {
  id          String    @id @default(cuid())
  itemId      String    // 外部ID（ユーザー指定）
  // サイズ（mm）
  x_mm        Int
  y_mm        Int
  z_mm        Int
  order       Int       // 配送順（1=最初に配送）
  loadOrder   Int?      // 積み込み順（1=最後に積む、配送順(order)と逆順。1が最初に配送される荷物を最後に積むことを意味します。）
  weight_kg   Float
  fragile     Boolean   @default(false)
  rot_xy      Boolean   @default(false)
  // 配置位置（原点基準、mm単位）
  posX        Float
  posY        Float
  posZ        Float
  rotation    Float     @default(0)
  // 追加情報
  name        String?   // 品目名
  destination String?   // 配送先
  // ステータス
  isLoaded    Boolean   @default(false)  // 積み込み済み
  loadedAt    DateTime?                   // 積み込み日時
  isDelivered Boolean   @default(false)  // 配送済み
  deliveredAt DateTime?                   // 配送日時
  // 3Dモデルデータ（外部APIから取得）
  objData     String?   @db.Text         // OBJファイルデータ
  mtlData     String?   @db.Text         // MTLファイルデータ
  // リレーション
  placement   Placement @relation(fields: [placementId], references: [id], onDelete: Cascade)
  placementId String
  createdAt   DateTime  @default(now())
}
